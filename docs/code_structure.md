# Software Overview

| **Software Area**   | **Actions**                                        | **Code**    | **Notes**                                    |
|---------------------|----------------------------------------------------|-------------|----------------------------------------------|
|          Web Server | Edit resources and play game                       | /web        | Currently flask based, will move to fastAPI. |
|         Game Engine | Interaction, Maps, Player, AI, Game state, Scripts | /game_engine |                                              |
| Resource Management | index and maintain resources                       | /chosm      |                                              |
| Might & Magic       | Transform M&M files to resources                   | /mam_game   | Other game importers would be possible.      |

## Web Server
Todo:
  - Get basic game view render
  - containerise a web stack (https://hub.docker.com/r/tiangolo/uvicorn-gunicorn-fastapi)
  - create a devops pipeline git -> docker -> droplet
  - stream resource files to browser direct via webserver, not the API  

## Game Engine
Todo:
  - Get a running game loop and session manager.
  - Scripting engine

This will be a time-consuming thing to complete and is low priority at the moment. 

## Resource Management
Todo:
  - "edit_packs", zip asset files the user can edit on their local machine, then re-upload.  


**Chosm uses "Resource Packs" to hold "assets" used to create "Worlds" in the game.** 

One world can use multiple resource packs, and a resource packs can be used in many worlds.

Features:
  - Resource packs are versioned, and games can use a version pinned as a "release".
  - Resource packs can overload other resource packs, replacing game assets for a world.

### Assets
Assets represent an item, object, entity, script, NPC, sprite, etc used to create a world.
Assets must be of a specific type, limited to:
  - Sprite
  - Map
  - NPC
  - NPC database
  - Palette
  - Text file
  - Binary file
  - Sound fx
  - Music
  - (more to come, including scripting)
  - Note: there are no "image" resources, everything is a sprite.

Assets have both an ID and a NAME. A name must be present. Id's are used as a secondly key because 
Chosim hopes to support running legacy games; that used integer ID's to identity objects. Names 
must be unique to the asset pack.

Id's must be unique when paired with the assets type. ie: 37 can be used to name both 
a sound and a sprite, but two sprites can not share the same ID (37).
Neither is required to be globally unique, but must be unique for the resource type (eg sprite).

An asset maps to a folder with a name derived from the TYPE + NAME.
This folder contains multiple files concerning the resource.

Files in the folder starting with a "_"  (eg: "_frame_0021.pmg") are considered "secondary files". 
The others are primary files. Secondary files are generated by the resource manager 
from the primary files. They can be safely deleted if modifying game content.

### There are two classes that should be understood regarding CHOSM assets: 

AssetRecord:
  - built for use by the web server
  - store metadata for the viewer and editor
  - store a slug representing the folder
  - stack to override each other
  - validate their own structure
  - can bootstrap an Asset from primary files

Asset:
  - built for use by software creating graphics for the game.
    - Might and magic asset import scripts
    - Sprite resize & creation AI
  - can be created from in memory objects
  - holds raw data, such as images and sound in memory
  - can perform operations on the data
  - can "bake" that data to an asset.
    - by this process, it will create secondary files from primary files

## Might & Magic
Todo:
  - Catalog sprites
  - Load Event scripts
  - Sound FX
  - Music
  - MaM 3 support
  - MaM 1&2 support

This concerns extracting game data and "baking" it to the resource file format.  